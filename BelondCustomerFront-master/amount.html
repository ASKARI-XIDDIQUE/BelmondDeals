<html>
<head>
    <title>Account Details</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Barlow:wght@400;600&display=swap" rel="stylesheet">
    <script>
        let currentPage = 1;
        const recordsPerPage = 20;
        const totalRecords = 100;
        const totalWithdrawRecords = 5;
        const totalCommissionRecords = 10;

        function showTab(tabName) {
            const tabs = document.querySelectorAll('.tab-content');
            tabs.forEach(tab => {
                tab.classList.add('hidden');
            });
            document.getElementById(tabName).classList.remove('hidden');

            const buttons = document.querySelectorAll('.tab-button');
            buttons.forEach(button => {
                button.classList.remove('border-custom', 'text-custom');
                button.classList.add('text-gray-600', 'border-transparent');
            });
            document.getElementById(tabName + '-button').classList.add('border-custom', 'text-custom');
            document.getElementById(tabName + '-button').classList.remove('text-gray-600', 'border-transparent');

            if (tabName === 'deposit') {
                // renderTable('deposit-tbody', totalRecords);
            } else if (tabName === 'withdraw') {
                // renderTable('withdraw-tbody', totalWithdrawRecords);
            } else if (tabName === 'commission') {
                // renderTable('commission-tbody', totalCommissionRecords);
            }
        }

        function renderTable(tbodyId, totalRecords) {
            const tbody = document.getElementById(tbodyId);
            tbody.innerHTML = '';

            const start = (currentPage - 1) * recordsPerPage;
            const end = start + recordsPerPage;

            for (let i = start + 1; i <= end && i <= totalRecords; i++) {
                tbody.innerHTML += `
                    <tr class="border-b ${i % 2 === 0 ? 'bg-gray-100' : ''}">
                        <td class="py-2 px-4 text-center">${i}</td>
                        <td class="py-2 px-4 text-center">${i.amount}</td>
                        <td class="py-2 px-4 text-center">${i.createdDate}</td>
                    </tr>
                `;
            }

            document.getElementById('page-info').innerText = `Page ${currentPage} of ${Math.ceil(totalRecords / recordsPerPage)}`;
        }

        function nextPage() {
            if (currentPage * recordsPerPage < totalRecords) {
                currentPage++;
                renderTable('deposit-tbody', totalRecords);
            }
        }

        function prevPage() {
            if (currentPage > 1) {
                currentPage--;
                renderTable('deposit-tbody', totalRecords);
            }
        }

        function nextPageWithdraw() {
            if (currentPage * recordsPerPage < totalWithdrawRecords) {
                currentPage++;
                renderTable('withdraw-tbody', totalWithdrawRecords);
            }
        }

        function prevPageWithdraw() {
            if (currentPage > 1) {
                currentPage--;
                renderTable('withdraw-tbody', totalWithdrawRecords);
            }
        }

        function nextPageCommission() {
            if (currentPage * recordsPerPage < totalCommissionRecords) {
                currentPage++;
                renderTable('commission-tbody', totalCommissionRecords);
            }
        }

        function prevPageCommission() {
            if (currentPage > 1) {
                currentPage--;
                renderTable('commission-tbody', totalCommissionRecords);
            }
        }

        // document.addEventListener('DOMContentLoaded', () => {
        //     renderTable('deposit-tbody', totalRecords);
        //     renderTable('withdraw-tbody', totalWithdrawRecords);
        //     renderTable('commission-tbody', totalCommissionRecords);
        // });
    </script>
    <style>
        .text-custom {
            color: #ab8554;
        }
        .border-custom {
            border-color: #ab8554;
        }
        .bg-custom {
            background-color: #ab8554;
        }
        body {
            font-family: 'Barlow', sans-serif;
        }
    </style>
</head>

<body class="bg-gray-100">
    <div class="max-w-4xl mx-auto p-4">
        <div class="flex items-center justify-between mb-4">
           <a href="details.html"> <i class="fas fa-arrow-left text-xl text-custom"></i></a>
            <h1 class="text-xl font-bold text-center flex-grow">Account Details</h1>
        </div>
        <div class="flex border-b mb-4 justify-center">
            <button id="deposit-button" class="tab-button px-4 py-2 text-custom font-semibold border-b-2 border-custom" onclick="showTab('deposit')">Deposit</button>
            <button id="withdraw-button" class="tab-button px-4 py-2 text-gray-600 font-semibold border-b-2 border-transparent" onclick="showTab('withdraw')">Withdraw</button>
            <button id="commission-button" class="tab-button px-4 py-2 text-gray-600 font-semibold border-b-2 border-transparent" onclick="showTab('commission')">Commission</button>
        </div>
        <div id="deposit" class="tab-content">
            <div class="overflow-x-auto">
                <table class="min-w-full bg-white" id="deposit-tbody">
                    <thead class="bg-custom text-white">
                        <tr>
                            <th class="py-2 px-4 text-center">No#</th>
                            <th class="py-2 px-4 text-center">Amount</th>
                            <th class="py-2 px-4 text-center">Date</th>
                        </tr>
                    </thead>
                    <tbody >
                        <!-- Records will be generated by JavaScript -->
                    </tbody>
                </table>
            </div>
            <!-- <div class="flex justify-between items-center mt-4">
                <button class="px-4 py-2 bg-custom text-white rounded" onclick="prevPage()">Previous</button>
                <span id="page-info" class="text-custom"></span>
                <button class="px-4 py-2 bg-custom text-white rounded" onclick="nextPage()">Next</button>
            </div> -->
        </div>
        <div id="withdraw" class="tab-content hidden">
            <div class="overflow-x-auto">
                <table class="min-w-full bg-white" id="withdraw-tbody">
                    <thead class="bg-custom text-white">
                        <tr>
                            <th class="py-2 px-4 text-center">No#</th>
                            <th class="py-2 px-4 text-center">Amount</th>
                            <th class="py-2 px-4 text-center">Date</th>
                            <th class="py-2 px-4 text-center">Status</th>
                        </tr>
                    </thead>
                    <tbody >
                        <!-- Records will be generated by JavaScript -->
                    </tbody>
                </table>
            </div>
            <!-- <div class="flex justify-between items-center mt-4">
                <button class="px-4 py-2 bg-custom text-white rounded" onclick="prevPageWithdraw()">Previous</button>
                <span id="page-info-withdraw" class="text-custom"></span>
                <button class="px-4 py-2 bg-custom text-white rounded" onclick="nextPageWithdraw()">Next</button>
            </div> -->
        </div>
        <div id="commission" class="tab-content hidden">
            <div class="overflow-x-auto">
                <table class="min-w-full bg-white" id="commission-tbody">
                    <thead class="bg-custom text-white">
                        <tr>
                            <th class="py-2 px-4 text-center">No#</th>
                            <th class="py-2 px-4 text-center">Amount</th>
                            <th class="py-2 px-4 text-center">Date</th>
                        </tr>
                    </thead>
                    <tbody >
                        <!-- Records will be generated by JavaScript -->
                    </tbody>
                </table>
            </div>
            <!-- <div class="flex justify-between items-center mt-4">
                <button class="px-4 py-2 bg-custom text-white rounded" onclick="prevPageCommission()">Previous</button>
                <span id="page-info-commission" class="text-custom"></span>
                <button class="px-4 py-2 bg-custom text-white rounded" onclick="nextPageCommission()">Next</button>
            </div> -->
        </div>
    </div>
    <script src="api.js"></script>
    <script src="constant.js"></script>
    <script>
    window.onload = function(){
        getByIdCom()
        getByIdDep()
        getAllWithdraw()
    }


    function getFormattedDate(incomingDate){
    const inputDate = incomingDate;
    const date = new Date(inputDate);
    const formattedDate = date.toISOString().split('T')[0];
    const time = date.toISOString().split('T')[1].split('.')[0];
    return formattedDate + ' ' + time
  }

async function getByIdCom() {
  try {
      let id=localStorage.getItem('userId');
      if(id !== null){
        const response = await fetch(apiUrl+'/userbonus/commissionList/'+id + '?invitationCode='+ localStorage.getItem('invitationCode') + '&userId=' + id);
        if (!response.ok) {
        const errorMessage = await response.text();
        throw new Error(errorMessage);
        }
        const dat = await response.json();
        dynamicData = dat.response;
        console.log("Response:", dat);
        generateTableRowsCom(dynamicData);
      }
    } catch (error) {
        console.error("Error:", error.message);
    }
}
function generateTableRowsCom(data) {
  const tbody = document.querySelector('#commission-tbody tbody');
  data.forEach((item, index) => {
      const row = document.createElement('tr');
      row.innerHTML = `
          <td class="py-2 px-4 text-center">${index + 1}</td>
          <td class="py-2 px-4 text-center">${item.amount}</td>
          <td class="py-2 px-4 text-center">${getFormattedDate(item.createdDate)}</td>
      `;
      tbody.appendChild(row);
  });
}
async function getByIdDep() {
  try {
      let id=localStorage.getItem('userId');
      if(id !== null){        
        const response = await fetch(apiUrl+'/userdeposit/'+id + '?invitationCode='+ localStorage.getItem('invitationCode') + '&userId=' + id);
        if (!response.ok) {
        const errorMessage = await response.text();
        throw new Error(errorMessage);
        }
        const dat = await response.json();
        dynamicData = dat.response;
        console.log("Response:", dat);
        generateTableRowsDep(dynamicData);
      }
  } catch (error) {
      console.error("Error:", error.message);
  }
  
}
function generateTableRowsDep(data) {
  const tbody = document.querySelector('#deposit-tbody tbody');
  data.forEach((item, index) => {
      const row = document.createElement('tr');
      row.innerHTML = `
          <td class="py-2 px-4 text-center">${index + 1}</td>
          <td class="py-2 px-4 text-center">${item.amount}</td>
          <td class="py-2 px-4 text-center">${getFormattedDate(item.createdDate)}</td>
          `;
      tbody.appendChild(row);
  });
}

function generateTableRowsWithdraw(data){
    const tbody = document.querySelector('#withdraw-tbody tbody');
  data.forEach((item, index) => {
      const row = document.createElement('tr');
      row.innerHTML = `
          <td class="py-2 px-4 text-center">${index + 1}</td>
          <td class="py-2 px-4 text-center">${item.commissionAmount}</td>
          <td class="py-2 px-4 text-center">${getFormattedDate(item.createdDate)}</td>
          <td class="py-2 px-4 text-center">${item.statusName}</td>
          `;
      tbody.appendChild(row);
  });
}

async function getAllWithdraw(){
    try{
        let id=localStorage.getItem('userId');
          if(id !== null){       
            const response = await fetch(apiUrl+'/withdraw/getAll/'+id);
            if (!response.ok) {
            const errorMessage = await response.text();
            throw new Error(errorMessage);
            }
            const dat = await response.json();
            dynamicData = dat.response;
            console.log("Response:", dat);
            generateTableRowsWithdraw(dynamicData);
           }
    }
    catch(error){
        console.error("Error:", error.message); 
    }
}
        // document.addEventListener('DOMContentLoaded', () => {
        //     renderTable('deposit-tbody', totalRecords);
        //     renderTable('withdraw-tbody', totalWithdrawRecords);
        //     renderTable('commission-tbody', totalCommissionRecords);
        // });
    </script>
</body>
</html>